"use strict";(globalThis.webpackChunkwebsite=globalThis.webpackChunkwebsite||[]).push([[331],{3756:(e,n,r)=>{r.r(n),r.d(n,{assets:()=>l,contentTitle:()=>t,default:()=>h,frontMatter:()=>a,metadata:()=>s,toc:()=>c});const s=JSON.parse('{"id":"operations/deployment","title":"Deployment","description":"Deploy AGRO to production with Docker Compose, environment configuration, and scaling strategies.","source":"@site/docs/operations/deployment.md","sourceDirName":"operations","slug":"/operations/deployment","permalink":"/agro-rag-engine/operations/deployment","draft":false,"unlisted":false,"editUrl":"https://github.com/DMontgomery40/agro-rag-engine/tree/main/website/docs/operations/deployment.md","tags":[],"version":"current","sidebarPosition":1,"frontMatter":{"sidebar_position":1},"sidebar":"docs","previous":{"title":"Architecture","permalink":"/agro-rag-engine/development/architecture"},"next":{"title":"Monitoring","permalink":"/agro-rag-engine/operations/monitoring"}}');var o=r(4848),i=r(8453);const a={sidebar_position:1},t="Deployment",l={},c=[{value:"Prerequisites",id:"prerequisites",level:2},{value:"Quick Production Deploy",id:"quick-production-deploy",level:2},{value:"Environment Configuration",id:"environment-configuration",level:2},{value:"Critical Variables",id:"critical-variables",level:3},{value:"Local-Only Deploy (Zero API Cost)",id:"local-only-deploy-zero-api-cost",level:3},{value:"Docker Compose Services",id:"docker-compose-services",level:2},{value:"Infrastructure Stack",id:"infrastructure-stack",level:3},{value:"Start/Stop Services",id:"startstop-services",level:3},{value:"Production Server Setup",id:"production-server-setup",level:2},{value:"Option 1: Gunicorn (Recommended)",id:"option-1-gunicorn-recommended",level:3},{value:"Option 2: Systemd Service",id:"option-2-systemd-service",level:3},{value:"Reverse Proxy (Nginx)",id:"reverse-proxy-nginx",level:2},{value:"TLS Termination",id:"tls-termination",level:3},{value:"Scaling Strategies",id:"scaling-strategies",level:2},{value:"Vertical Scaling (Single Machine)",id:"vertical-scaling-single-machine",level:3},{value:"Horizontal Scaling (Multi-Machine)",id:"horizontal-scaling-multi-machine",level:3},{value:"Backup &amp; Recovery",id:"backup--recovery",level:2},{value:"Backup Strategy",id:"backup-strategy",level:3},{value:"Restore from Backup",id:"restore-from-backup",level:3},{value:"Monitoring &amp; Alerts",id:"monitoring--alerts",level:2},{value:"Prometheus Alerts",id:"prometheus-alerts",level:3},{value:"Grafana Dashboards",id:"grafana-dashboards",level:3},{value:"Health Checks",id:"health-checks",level:2},{value:"Endpoint Health",id:"endpoint-health",level:3},{value:"Docker Health",id:"docker-health",level:3},{value:"Index Health",id:"index-health",level:3},{value:"Security Hardening",id:"security-hardening",level:2},{value:"API Key Authentication",id:"api-key-authentication",level:3},{value:"CORS Configuration",id:"cors-configuration",level:3},{value:"Firewall Rules",id:"firewall-rules",level:3},{value:"Performance Tuning",id:"performance-tuning",level:2},{value:"Qdrant Optimization",id:"qdrant-optimization",level:3},{value:"Redis Persistence",id:"redis-persistence",level:3},{value:"Gunicorn Workers",id:"gunicorn-workers",level:3},{value:"Troubleshooting Deployment",id:"troubleshooting-deployment",level:2},{value:"&quot;Qdrant connection refused&quot;",id:"qdrant-connection-refused",level:3},{value:"&quot;Redis LOADING error&quot;",id:"redis-loading-error",level:3},{value:"&quot;ModuleNotFoundError&quot;",id:"modulenotfounderror",level:3},{value:"&quot;Permission denied&quot; errors",id:"permission-denied-errors",level:3},{value:"Next Steps",id:"next-steps",level:2}];function d(e){const n={a:"a",code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",hr:"hr",li:"li",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,i.R)(),...e.components};return(0,o.jsxs)(o.Fragment,{children:[(0,o.jsx)(n.header,{children:(0,o.jsx)(n.h1,{id:"deployment",children:"Deployment"})}),"\n",(0,o.jsx)(n.p,{children:"Deploy AGRO to production with Docker Compose, environment configuration, and scaling strategies."}),"\n",(0,o.jsx)(n.h2,{id:"prerequisites",children:"Prerequisites"}),"\n",(0,o.jsxs)(n.ul,{children:["\n",(0,o.jsxs)(n.li,{children:[(0,o.jsx)(n.strong,{children:"Docker Desktop"})," 20.10+ or Docker Engine + Docker Compose V2"]}),"\n",(0,o.jsx)(n.li,{children:(0,o.jsx)(n.strong,{children:"Python 3.11+"})}),"\n",(0,o.jsxs)(n.li,{children:[(0,o.jsx)(n.strong,{children:"4GB RAM minimum"})," (8GB recommended for production)"]}),"\n",(0,o.jsxs)(n.li,{children:[(0,o.jsx)(n.strong,{children:"10GB disk space"})," (varies with index size)"]}),"\n",(0,o.jsxs)(n.li,{children:[(0,o.jsx)(n.strong,{children:"Linux/macOS"})," (Windows via WSL2)"]}),"\n"]}),"\n",(0,o.jsx)(n.h2,{id:"quick-production-deploy",children:"Quick Production Deploy"}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-bash",children:"# Clone repository\ngit clone https://github.com/DMontgomery40/agro-rag-engine.git\ncd agro-rag-engine\n\n# Create production .env\ncp .env.example .env\nnano .env  # Configure production settings\n\n# Start infrastructure\ndocker compose up -d\n\n# Install Python dependencies\npython3.11 -m venv .venv\nsource .venv/bin/activate\npip install -r requirements.txt\n\n# Run indexing\npython scripts/full_index.py --repo your-repo --source-dir /path/to/code\n\n# Start server (production mode)\ngunicorn server.app:app \\\n  --workers 4 \\\n  --worker-class uvicorn.workers.UvicornWorker \\\n  --bind 0.0.0.0:8012 \\\n  --access-logfile - \\\n  --error-logfile -\n"})}),"\n",(0,o.jsxs)(n.p,{children:["Server runs at ",(0,o.jsx)(n.a,{href:"http://0.0.0.0:8012",children:"http://0.0.0.0:8012"})," (accessible on LAN)."]}),"\n",(0,o.jsx)(n.hr,{}),"\n",(0,o.jsx)(n.h2,{id:"environment-configuration",children:"Environment Configuration"}),"\n",(0,o.jsx)(n.h3,{id:"critical-variables",children:"Critical Variables"}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-bash",children:"# Repository\nREPO=your-repo-name\nSOURCE_DIR=/absolute/path/to/your/code\n\n# Models (choose cloud or local)\nEMBEDDING_TYPE=openai  # openai|voyage|local\nGENERATION_MODEL=gpt-4o\nRERANK_BACKEND=local  # local|cohere\n\n# API Keys (if using cloud)\nOPENAI_API_KEY=sk-proj-...\nVOYAGE_API_KEY=pa-...\nCOHERE_API_KEY=...\n\n# Infrastructure\nQDRANT_URL=http://127.0.0.1:6333\nREDIS_URL=redis://127.0.0.1:6379/0\n\n# Performance\nTOPK_SPARSE=75\nTOPK_DENSE=75\nQUERY_EXPANSION_COUNT=4\nHYDRATION_MODE=lazy\n\n# Observability\nLANGCHAIN_TRACING_V2=true\nLANGCHAIN_API_KEY=...\nLANGCHAIN_PROJECT=agro-prod\n\n# Security (optional)\nAGRO_API_KEY=your-secret-key\nAGRO_CORS_ORIGINS=https://yourdomain.com\n"})}),"\n",(0,o.jsx)(n.h3,{id:"local-only-deploy-zero-api-cost",children:"Local-Only Deploy (Zero API Cost)"}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-bash",children:"# Use local models exclusively\nEMBEDDING_TYPE=local\nEMBEDDING_MODEL_LOCAL=BAAI/bge-small-en-v1.5\nGENERATION_MODEL=ollama:qwen3-coder:30b\nRERANK_BACKEND=local\nRERANK_MODEL_LOCAL=cross-encoder/ms-marco-MiniLM-L-12-v2\n\n# No API keys needed\n# OPENAI_API_KEY not set\n# VOYAGE_API_KEY not set\n# COHERE_API_KEY not set\n"})}),"\n",(0,o.jsx)(n.p,{children:(0,o.jsx)(n.strong,{children:"Requirements:"})}),"\n",(0,o.jsxs)(n.ul,{children:["\n",(0,o.jsx)(n.li,{children:"Ollama installed locally"}),"\n",(0,o.jsxs)(n.li,{children:["Models downloaded: ",(0,o.jsx)(n.code,{children:"ollama pull qwen3-coder:30b"})]}),"\n",(0,o.jsx)(n.li,{children:"16GB+ RAM for large generation models"}),"\n"]}),"\n",(0,o.jsx)(n.hr,{}),"\n",(0,o.jsx)(n.h2,{id:"docker-compose-services",children:"Docker Compose Services"}),"\n",(0,o.jsx)(n.h3,{id:"infrastructure-stack",children:"Infrastructure Stack"}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-yaml",children:'services:\n  # Vector database\n  qdrant:\n    image: qdrant/qdrant:v1.15.5\n    ports:\n      - "6333:6333"  # HTTP API\n      - "6334:6334"  # gRPC\n    volumes:\n      - ../data/qdrant:/qdrant/storage\n    restart: unless-stopped\n\n  # State management\n  redis:\n    image: redis/redis-stack:7.2.0-v10\n    ports:\n      - "6379:6379"\n    restart: unless-stopped\n\n  # Metrics\n  prometheus:\n    image: prom/prometheus:latest\n    ports:\n      - "9090:9090"\n    volumes:\n      - ./prometheus.yml:/etc/prometheus/prometheus.yml:ro\n    restart: unless-stopped\n\n  # Dashboards\n  grafana:\n    image: grafana/grafana:latest\n    ports:\n      - "3000:3000"\n    environment:\n      - GF_SECURITY_ADMIN_PASSWORD=your-password\n      - GF_SECURITY_ALLOW_EMBEDDING=true\n    volumes:\n      - grafana_data:/var/lib/grafana\n      - ./grafana/provisioning:/etc/grafana/provisioning:ro\n    restart: unless-stopped\n'})}),"\n",(0,o.jsx)(n.h3,{id:"startstop-services",children:"Start/Stop Services"}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-bash",children:"# Start all services\ndocker compose up -d\n\n# Check status\ndocker compose ps\n\n# View logs\ndocker compose logs -f qdrant\ndocker compose logs -f redis\n\n# Stop services\ndocker compose down\n\n# Stop and remove volumes (wipes data)\ndocker compose down -v\n"})}),"\n",(0,o.jsx)(n.hr,{}),"\n",(0,o.jsx)(n.h2,{id:"production-server-setup",children:"Production Server Setup"}),"\n",(0,o.jsx)(n.h3,{id:"option-1-gunicorn-recommended",children:"Option 1: Gunicorn (Recommended)"}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-bash",children:"# Install gunicorn\npip install gunicorn uvicorn[standard]\n\n# Run with multiple workers\ngunicorn server.app:app \\\n  --workers 4 \\\n  --worker-class uvicorn.workers.UvicornWorker \\\n  --bind 0.0.0.0:8012 \\\n  --timeout 120 \\\n  --access-logfile /var/log/agro/access.log \\\n  --error-logfile /var/log/agro/error.log \\\n  --log-level info\n"})}),"\n",(0,o.jsxs)(n.p,{children:[(0,o.jsx)(n.strong,{children:"Worker count:"})," ",(0,o.jsx)(n.code,{children:"(2 * CPU_cores) + 1"})]}),"\n",(0,o.jsx)(n.h3,{id:"option-2-systemd-service",children:"Option 2: Systemd Service"}),"\n",(0,o.jsxs)(n.p,{children:["Create ",(0,o.jsx)(n.code,{children:"/etc/systemd/system/agro.service"}),":"]}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-ini",children:'[Unit]\nDescription=AGRO RAG Server\nAfter=network.target docker.service\nRequires=docker.service\n\n[Service]\nType=notify\nUser=agro\nGroup=agro\nWorkingDirectory=/opt/agro-rag-engine\nEnvironment="PATH=/opt/agro-rag-engine/.venv/bin"\nExecStart=/opt/agro-rag-engine/.venv/bin/gunicorn server.app:app \\\n  --workers 4 \\\n  --worker-class uvicorn.workers.UvicornWorker \\\n  --bind 0.0.0.0:8012 \\\n  --timeout 120\nRestart=always\nRestartSec=10\n\n[Install]\nWantedBy=multi-user.target\n'})}),"\n",(0,o.jsx)(n.p,{children:"Enable and start:"}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-bash",children:"sudo systemctl daemon-reload\nsudo systemctl enable agro\nsudo systemctl start agro\nsudo systemctl status agro\n"})}),"\n",(0,o.jsx)(n.hr,{}),"\n",(0,o.jsx)(n.h2,{id:"reverse-proxy-nginx",children:"Reverse Proxy (Nginx)"}),"\n",(0,o.jsx)(n.h3,{id:"tls-termination",children:"TLS Termination"}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-nginx",children:'# /etc/nginx/sites-available/agro\nserver {\n    listen 443 ssl http2;\n    server_name agro.yourdomain.com;\n\n    ssl_certificate /etc/letsencrypt/live/agro.yourdomain.com/fullchain.pem;\n    ssl_certificate_key /etc/letsencrypt/live/agro.yourdomain.com/privkey.pem;\n\n    location / {\n        proxy_pass http://127.0.0.1:8012;\n        proxy_set_header Host $host;\n        proxy_set_header X-Real-IP $remote_addr;\n        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;\n        proxy_set_header X-Forwarded-Proto $scheme;\n\n        # WebSocket support (for SSE/WS transports)\n        proxy_http_version 1.1;\n        proxy_set_header Upgrade $http_upgrade;\n        proxy_set_header Connection "upgrade";\n\n        # Timeouts for long-running queries\n        proxy_read_timeout 300s;\n        proxy_connect_timeout 75s;\n    }\n\n    # Grafana iframe embedding\n    location /grafana/ {\n        proxy_pass http://127.0.0.1:3000/;\n        proxy_set_header Host $host;\n    }\n}\n\n# Redirect HTTP to HTTPS\nserver {\n    listen 80;\n    server_name agro.yourdomain.com;\n    return 301 https://$server_name$request_uri;\n}\n'})}),"\n",(0,o.jsx)(n.p,{children:"Enable:"}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-bash",children:"sudo ln -s /etc/nginx/sites-available/agro /etc/nginx/sites-enabled/\nsudo nginx -t\nsudo systemctl reload nginx\n"})}),"\n",(0,o.jsx)(n.hr,{}),"\n",(0,o.jsx)(n.h2,{id:"scaling-strategies",children:"Scaling Strategies"}),"\n",(0,o.jsx)(n.h3,{id:"vertical-scaling-single-machine",children:"Vertical Scaling (Single Machine)"}),"\n",(0,o.jsx)(n.p,{children:(0,o.jsxs)(n.strong,{children:["For ",(0,o.jsx)(n.code,{children:"\\<10klt;10k"})," chunks:"]})}),"\n",(0,o.jsxs)(n.ul,{children:["\n",(0,o.jsx)(n.li,{children:"2 CPU cores, 4GB RAM"}),"\n",(0,o.jsx)(n.li,{children:"Local BM25 + OpenAI embeddings"}),"\n"]}),"\n",(0,o.jsx)(n.p,{children:(0,o.jsx)(n.strong,{children:"For 10k-50k chunks:"})}),"\n",(0,o.jsxs)(n.ul,{children:["\n",(0,o.jsx)(n.li,{children:"4 CPU cores, 8GB RAM"}),"\n",(0,o.jsx)(n.li,{children:"Gunicorn with 4 workers"}),"\n"]}),"\n",(0,o.jsx)(n.p,{children:(0,o.jsx)(n.strong,{children:"For 50k+ chunks:"})}),"\n",(0,o.jsxs)(n.ul,{children:["\n",(0,o.jsx)(n.li,{children:"8+ CPU cores, 16GB+ RAM"}),"\n",(0,o.jsx)(n.li,{children:"Consider horizontal scaling"}),"\n"]}),"\n",(0,o.jsx)(n.h3,{id:"horizontal-scaling-multi-machine",children:"Horizontal Scaling (Multi-Machine)"}),"\n",(0,o.jsx)(n.p,{children:(0,o.jsx)(n.strong,{children:"Architecture:"})}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{children:"Load Balancer (HAProxy/Nginx)\n  \u2193\n\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502  AGRO-1    \u2502  AGRO-2    \u2502  AGRO-3    \u2502\n\u2502  (API)     \u2502  (API)     \u2502  (API)     \u2502\n\u2514\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n     \u2502            \u2502            \u2502\n     \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u253c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n                  \u2193\n  \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n  \u2502  Shared Infrastructure        \u2502\n  \u2502  \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510  \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510   \u2502\n  \u2502  \u2502 Qdrant  \u2502  \u2502  Redis   \u2502   \u2502\n  \u2502  \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518  \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518   \u2502\n  \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n"})}),"\n",(0,o.jsx)(n.p,{children:(0,o.jsx)(n.strong,{children:"HAProxy config:"})}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{children:"backend agro_api\n    mode http\n    balance roundrobin\n    option httpchk GET /health\n    server agro1 10.0.0.10:8012 check\n    server agro2 10.0.0.11:8012 check\n    server agro3 10.0.0.12:8012 check\n"})}),"\n",(0,o.jsx)(n.p,{children:(0,o.jsx)(n.strong,{children:"Shared Qdrant:"})}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-bash",children:"# On each API server, point to central Qdrant\nQDRANT_URL=http://10.0.0.20:6333\n"})}),"\n",(0,o.jsx)(n.hr,{}),"\n",(0,o.jsx)(n.h2,{id:"backup--recovery",children:"Backup & Recovery"}),"\n",(0,o.jsx)(n.h3,{id:"backup-strategy",children:"Backup Strategy"}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-bash",children:"#!/bin/bash\n# /opt/agro/backup.sh\n\nBACKUP_DIR=/backups/agro/$(date +%Y-%m-%d)\nmkdir -p $BACKUP_DIR\n\n# Backup data directory (chunks, BM25 indexes)\ntar -czf $BACKUP_DIR/data.tar.gz data/\n\n# Backup Qdrant collection\ncurl -X POST http://127.0.0.1:6333/collections/code_chunks_agro/snapshots \\\n  -H 'Content-Type: application/json'\n\n# Export Redis state (LangGraph checkpoints)\ndocker exec rag-redis redis-cli --rdb /data/dump.rdb\ncp data/redis/dump.rdb $BACKUP_DIR/\n\n# Backup configs\ncp .env $BACKUP_DIR/\ncp gui/profiles/*.json $BACKUP_DIR/profiles/\n\necho \"Backup complete: $BACKUP_DIR\"\n"})}),"\n",(0,o.jsx)(n.p,{children:(0,o.jsx)(n.strong,{children:"Cron schedule:"})}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-cron",children:"# Daily backups at 2 AM\n0 2 * * * /opt/agro/backup.sh\n"})}),"\n",(0,o.jsx)(n.h3,{id:"restore-from-backup",children:"Restore from Backup"}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-bash",children:"# Stop services\ndocker compose down\n\n# Restore data\ntar -xzf /backups/agro/2025-01-19/data.tar.gz\n\n# Restore Redis\ncp /backups/agro/2025-01-19/dump.rdb data/redis/\n\n# Restore Qdrant (upload snapshot via API)\ncurl -X PUT http://127.0.0.1:6333/collections/code_chunks_agro/snapshots/upload \\\n  -F 'snapshot=@/backups/agro/2025-01-19/qdrant-snapshot.tar'\n\n# Restart\ndocker compose up -d\n"})}),"\n",(0,o.jsx)(n.hr,{}),"\n",(0,o.jsx)(n.h2,{id:"monitoring--alerts",children:"Monitoring & Alerts"}),"\n",(0,o.jsx)(n.h3,{id:"prometheus-alerts",children:"Prometheus Alerts"}),"\n",(0,o.jsxs)(n.p,{children:["Configure in ",(0,o.jsx)(n.code,{children:"infra/prometheus-alert-rules.yml"}),":"]}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-yaml",children:'groups:\n  - name: agro_alerts\n    rules:\n      - alert: HighErrorRate\n        expr: rate(agro_requests_total{success="false"}[5m]) > 0.1\n        for: 5m\n        labels:\n          severity: warning\n        annotations:\n          summary: "High error rate detected"\n\n      - alert: SlowQueries\n        expr: histogram_quantile(0.95, agro_request_duration_seconds) > 5\n        for: 10m\n        labels:\n          severity: warning\n        annotations:\n          summary: "95th percentile latency > 5s"\n\n      - alert: QdrantDown\n        expr: up{job="qdrant"} == 0\n        for: 2m\n        labels:\n          severity: critical\n        annotations:\n          summary: "Qdrant is down"\n'})}),"\n",(0,o.jsx)(n.h3,{id:"grafana-dashboards",children:"Grafana Dashboards"}),"\n",(0,o.jsxs)(n.p,{children:["Pre-configured dashboards in ",(0,o.jsx)(n.code,{children:"infra/grafana/provisioning/dashboards/"}),":"]}),"\n",(0,o.jsxs)(n.ul,{children:["\n",(0,o.jsxs)(n.li,{children:[(0,o.jsx)(n.strong,{children:"AGRO Overview"}),": Request rates, latency, errors"]}),"\n",(0,o.jsxs)(n.li,{children:[(0,o.jsx)(n.strong,{children:"Retrieval Quality"}),": MRR, Hit@K, confidence scores"]}),"\n",(0,o.jsxs)(n.li,{children:[(0,o.jsx)(n.strong,{children:"Cost Tracking"}),": Token usage, API costs"]}),"\n",(0,o.jsxs)(n.li,{children:[(0,o.jsx)(n.strong,{children:"Infrastructure"}),": Docker container health, resource usage"]}),"\n"]}),"\n",(0,o.jsxs)(n.p,{children:["Access at: ",(0,o.jsx)(n.code,{children:"http://your-domain:3000"})]}),"\n",(0,o.jsx)(n.hr,{}),"\n",(0,o.jsx)(n.h2,{id:"health-checks",children:"Health Checks"}),"\n",(0,o.jsx)(n.h3,{id:"endpoint-health",children:"Endpoint Health"}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-bash",children:'# Basic health\ncurl http://127.0.0.1:8012/health\n\n# Expected:\n{\n  "status": "healthy",\n  "graph_loaded": true,\n  "ts": "2025-01-19T12:34:56.789Z",\n  "checks": {\n    "qdrant": "healthy",\n    "redis": "healthy",\n    "prometheus": "healthy",\n    "grafana": "healthy"\n  }\n}\n'})}),"\n",(0,o.jsx)(n.h3,{id:"docker-health",children:"Docker Health"}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-bash",children:'# Check container status\ndocker compose ps\n\n# Expected: all services "Up" and "healthy"\n'})}),"\n",(0,o.jsx)(n.h3,{id:"index-health",children:"Index Health"}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-bash",children:'# Check index stats\ncurl http://127.0.0.1:8012/api/index/stats\n\n# Expected:\n{\n  "agro": {\n    "chunk_count": 3420,\n    "file_count": 287,\n    "last_indexed": "2025-01-19T10:00:00Z"\n  }\n}\n'})}),"\n",(0,o.jsx)(n.hr,{}),"\n",(0,o.jsx)(n.h2,{id:"security-hardening",children:"Security Hardening"}),"\n",(0,o.jsx)(n.h3,{id:"api-key-authentication",children:"API Key Authentication"}),"\n",(0,o.jsxs)(n.p,{children:["Add to ",(0,o.jsx)(n.code,{children:".env"}),":"]}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-bash",children:"AGRO_API_KEY=your-random-secret-key-here\n"})}),"\n",(0,o.jsx)(n.p,{children:"Middleware auto-enabled if set. Clients must include:"}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-bash",children:"curl http://127.0.0.1:8012/search?q=test \\\n  -H 'X-API-Key: your-random-secret-key-here'\n"})}),"\n",(0,o.jsx)(n.h3,{id:"cors-configuration",children:"CORS Configuration"}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-bash",children:"# Restrict origins (comma-separated)\nAGRO_CORS_ORIGINS=https://yourdomain.com,https://app.yourdomain.com\n\n# Or allow all (dev only)\nAGRO_CORS_ORIGINS=*\n"})}),"\n",(0,o.jsx)(n.h3,{id:"firewall-rules",children:"Firewall Rules"}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-bash",children:"# Allow only necessary ports\nsudo ufw allow 22/tcp    # SSH\nsudo ufw allow 443/tcp   # HTTPS\nsudo ufw deny 8012/tcp   # Direct API access (use Nginx only)\nsudo ufw deny 6333/tcp   # Qdrant (internal only)\nsudo ufw deny 6379/tcp   # Redis (internal only)\nsudo ufw enable\n"})}),"\n",(0,o.jsx)(n.hr,{}),"\n",(0,o.jsx)(n.h2,{id:"performance-tuning",children:"Performance Tuning"}),"\n",(0,o.jsx)(n.h3,{id:"qdrant-optimization",children:"Qdrant Optimization"}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-bash",children:"# Increase memory limit (docker-compose.yml)\nenvironment:\n  - QDRANT__STORAGE__USE_MMAP=false  # Use RAM (faster)\n  - QDRANT__SERVICE__MAX_REQUEST_SIZE_MB=32\n"})}),"\n",(0,o.jsx)(n.h3,{id:"redis-persistence",children:"Redis Persistence"}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-bash",children:"# Enable AOF persistence (safer for production)\nenvironment:\n  - REDIS_ARGS=--appendonly yes --appendfsync everysec\nvolumes:\n  - ../data/redis:/data\n"})}),"\n",(0,o.jsx)(n.h3,{id:"gunicorn-workers",children:"Gunicorn Workers"}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-bash",children:'# Calculate optimal workers\npython3 -c "import multiprocessing; print(2 * multiprocessing.cpu_count() + 1)"\n\n# Set in systemd service or run command\n--workers 9  # For 4-core machine\n'})}),"\n",(0,o.jsx)(n.hr,{}),"\n",(0,o.jsx)(n.h2,{id:"troubleshooting-deployment",children:"Troubleshooting Deployment"}),"\n",(0,o.jsx)(n.h3,{id:"qdrant-connection-refused",children:'"Qdrant connection refused"'}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-bash",children:"# Check if Qdrant is running\ndocker ps | grep qdrant\n\n# If not, start it\ndocker compose up -d qdrant\n\n# Check logs\ndocker logs qdrant\n"})}),"\n",(0,o.jsx)(n.h3,{id:"redis-loading-error",children:'"Redis LOADING error"'}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-bash",children:'# Wait for Redis to finish loading AOF\ndocker logs rag-redis\n\n# Or disable persistence (faster, riskier)\n# In docker-compose.yml: REDIS_ARGS=--save ""\n'})}),"\n",(0,o.jsx)(n.h3,{id:"modulenotfounderror",children:'"ModuleNotFoundError"'}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-bash",children:"# Ensure virtual environment is activated\nsource .venv/bin/activate\n\n# Reinstall dependencies\npip install -r requirements.txt --force-reinstall\n"})}),"\n",(0,o.jsx)(n.h3,{id:"permission-denied-errors",children:'"Permission denied" errors'}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-bash",children:"# Fix data directory permissions\nsudo chown -R $(whoami):$(whoami) data/\nchmod -R 755 data/\n"})}),"\n",(0,o.jsx)(n.hr,{}),"\n",(0,o.jsx)(n.h2,{id:"next-steps",children:"Next Steps"}),"\n",(0,o.jsxs)(n.ul,{children:["\n",(0,o.jsxs)(n.li,{children:[(0,o.jsx)(n.strong,{children:(0,o.jsx)(n.a,{href:"/agro-rag-engine/operations/monitoring",children:"Monitoring"})})," - Set up Grafana dashboards"]}),"\n",(0,o.jsxs)(n.li,{children:[(0,o.jsx)(n.strong,{children:(0,o.jsx)(n.a,{href:"/agro-rag-engine/operations/troubleshooting",children:"Troubleshooting"})})," - Common issues and solutions"]}),"\n",(0,o.jsxs)(n.li,{children:[(0,o.jsx)(n.strong,{children:(0,o.jsx)(n.a,{href:"/agro-rag-engine/api/endpoints",children:"API Reference"})})," - HTTP endpoints for automation"]}),"\n"]})]})}function h(e={}){const{wrapper:n}={...(0,i.R)(),...e.components};return n?(0,o.jsx)(n,{...e,children:(0,o.jsx)(d,{...e})}):d(e)}},8453:(e,n,r)=>{r.d(n,{R:()=>a,x:()=>t});var s=r(6540);const o={},i=s.createContext(o);function a(e){const n=s.useContext(i);return s.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function t(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(o):e.components||o:a(e.components),s.createElement(i.Provider,{value:n},e.children)}}}]);