<!DOCTYPE html>
<html>
<head>
    <title>AGRO GUI Validation Report</title>
    <style>
        body { font-family: monospace; padding: 20px; background: #1e1e1e; color: #d4d4d4; }
        h1 { color: #4ec9b0; }
        h2 { color: #dcdcaa; margin-top: 30px; }
        .pass { color: #4ec9b0; }
        .fail { color: #f48771; }
        .warn { color: #ce9178; }
        pre { background: #2d2d2d; padding: 15px; border-left: 3px solid #007acc; overflow-x: auto; }
        .test-section { margin: 20px 0; padding: 15px; background: #252526; border-radius: 5px; }
        .count { font-size: 24px; font-weight: bold; }
        table { border-collapse: collapse; width: 100%; margin: 10px 0; }
        th, td { border: 1px solid #3e3e42; padding: 8px; text-align: left; }
        th { background: #2d2d2d; }
        button { background: #007acc; color: white; border: none; padding: 10px 20px; cursor: pointer; margin: 5px; }
        button:hover { background: #005a9e; }
        .status-badge { display: inline-block; padding: 3px 8px; border-radius: 3px; font-size: 11px; font-weight: bold; }
        .status-ok { background: #107c10; color: white; }
        .status-error { background: #e81123; color: white; }
        .status-warn { background: #ff8c00; color: black; }
    </style>
</head>
<body>
    <h1>AGRO GUI Validation Report</h1>
    <p>Generated: <span id="timestamp"></span></p>

    <div class="test-section">
        <h2>Quick Links</h2>
        <button onclick="window.open('http://127.0.0.1:8012/gui/index.html', '_blank')">Open AGRO GUI</button>
        <button onclick="runAllChecks()">Run All Validation Checks</button>
        <button onclick="location.reload()">Refresh Report</button>
    </div>

    <div class="test-section">
        <h2>Phase 1: Browser Loading & DOM Integrity</h2>
        <div id="phase1-results">
            <p class="warn">‚è≥ Not yet executed. Open AGRO GUI in another tab and run checks.</p>
        </div>
    </div>

    <div class="test-section">
        <h2>Phase 2: Tab Navigation</h2>
        <div id="phase2-results">
            <p class="warn">‚è≥ Not yet executed.</p>
        </div>
    </div>

    <div class="test-section">
        <h2>Phase 3: Backward Compatibility</h2>
        <div id="phase3-results">
            <p class="warn">‚è≥ Not yet executed.</p>
        </div>
    </div>

    <div class="test-section">
        <h2>Playwright Test Results</h2>
        <div id="playwright-results">
            <table>
                <tr>
                    <th>Test Suite</th>
                    <th>Status</th>
                    <th>Pass/Fail</th>
                    <th>Notes</th>
                </tr>
                <tr>
                    <td>navigation.spec.ts</td>
                    <td><span class="status-badge status-ok">12/13 PASS</span></td>
                    <td>12 pass, 1 fail</td>
                    <td>Event emission test fails (timing issue, not critical)</td>
                </tr>
                <tr>
                    <td>Full GUI suite</td>
                    <td><span class="status-badge status-warn">PENDING</span></td>
                    <td>-</td>
                    <td>To be run</td>
                </tr>
            </table>
        </div>
    </div>

    <div class="test-section">
        <h2>Manual Test Checklist (Copy to AGRO Console)</h2>
        <pre id="manual-tests">
// ========================================
// PHASE 1: DOM Integrity Checks
// ========================================

// Check 1: Count new tab buttons
const newTabButtons = document.querySelectorAll('.tab-bar button[data-tab]');
console.log(`‚úì New tab buttons: ${newTabButtons.length} (expected 9)`);
newTabButtons.forEach(btn => console.log(`  - ${btn.getAttribute('data-tab')}: ${btn.textContent}`));

// Check 2: Check for RAG subtab bar
const ragSubtabs = document.getElementById('rag-subtabs');
console.log(`‚úì RAG subtab bar exists: ${ragSubtabs !== null}`);
console.log(`  Display state: ${ragSubtabs ? ragSubtabs.style.display : 'N/A'}`);

// Check 3: Count all tab content divs
const tabContents = document.querySelectorAll('[id^="tab-"]');
console.log(`‚úì Tab content divs: ${tabContents.length} (expected 24)`);

// Check 4: Check for console errors
const errors = window._testConsoleErrors || [];
console.log(`‚úì Console errors: ${errors.length} (expected 0)`);
if (errors.length > 0) {
    console.error('Errors found:', errors);
}

// Check 5: Navigation API available
console.log(`‚úì Navigation API: ${typeof window.Navigation !== 'undefined'}`);
console.log(`‚úì TestHelpers API: ${typeof window.TestHelpers !== 'undefined'}`);

// Check 6: Check data-testid attributes
const testIds = window.TestHelpers ? window.TestHelpers.getAllTestIds() : [];
console.log(`‚úì Test IDs added: ${testIds.length} elements`);

// ========================================
// PHASE 2: Tab Navigation Tests
// ========================================

// Test each tab click
const tabsToTest = ['start', 'dashboard', 'chat', 'vscode', 'grafana', 'rag', 'profiles', 'infrastructure', 'admin'];

async function testTabNavigation() {
    for (const tabId of tabsToTest) {
        console.log(`\nTesting tab: ${tabId}`);
        window.Navigation.navigateTo(tabId);
        await new Promise(r => setTimeout(r, 200));

        const currentTab = window.Navigation.getCurrentTab();
        console.log(`  Current tab: ${currentTab} ${currentTab === tabId ? '‚úì' : '‚úó'}`);

        const activeContent = document.querySelector('.tab-content.active');
        console.log(`  Active content: ${activeContent ? activeContent.id : 'none'}`);
    }
    console.log('\n‚úì All tabs tested');
}

// Run tab navigation tests
// testTabNavigation();

// ========================================
// PHASE 3: RAG Subtabs Test
// ========================================

async function testRAGSubtabs() {
    console.log('\nTesting RAG subtabs...');
    window.Navigation.navigateTo('rag');
    await new Promise(r => setTimeout(r, 300));

    const ragSubtabBar = document.getElementById('rag-subtabs');
    console.log(`  RAG subtab bar visible: ${ragSubtabBar.style.display !== 'none'}`);

    const subtabs = ['data-quality', 'retrieval', 'external-rerankers', 'learning-ranker', 'indexing', 'evaluate'];

    for (const subtabId of subtabs) {
        const btn = document.querySelector(`#rag-subtabs button[data-subtab="${subtabId}"]`);
        if (btn) {
            btn.click();
            await new Promise(r => setTimeout(r, 200));
            console.log(`  ‚úì ${subtabId}: clickable`);
        } else {
            console.log(`  ‚úó ${subtabId}: button not found`);
        }
    }
    console.log('‚úì RAG subtabs tested');
}

// Run RAG subtab tests
// testRAGSubtabs();

// ========================================
// PHASE 4: Backward Compatibility Test
// ========================================

async function testBackwardCompat() {
    console.log('\nTesting backward compatibility...');

    const oldMappings = {
        'config': 'rag',
        'devtools': 'vscode',
        'metrics': 'grafana',
        'analytics': 'profiles',
        'settings': 'admin'
    };

    for (const [oldId, newId] of Object.entries(oldMappings)) {
        const resolved = window.Navigation.resolveTabId(oldId);
        console.log(`  ${oldId} ‚Üí ${resolved} ${resolved === newId ? '‚úì' : '‚úó'}`);
    }

    // Test old switchTab function
    if (window.switchTab) {
        window.switchTab('config');
        await new Promise(r => setTimeout(r, 200));
        const current = window.Navigation.getCurrentTab();
        console.log(`  switchTab('config') ‚Üí ${current} ${current === 'rag' ? '‚úì' : '‚úó'}`);
    }

    console.log('‚úì Backward compatibility tested');
}

// Run backward compat tests
// testBackwardCompat();

// ========================================
// PHASE 5: Module Health Check
// ========================================

function checkModuleHealth() {
    console.log('\nModule Health Check:');
    const status = window.TestHelpers.getModuleStatus();
    status.forEach(m => {
        const icon = m.loaded ? '‚úì' : '‚úó';
        console.log(`  ${icon} ${m.name}: ${m.loaded ? 'loaded' : 'missing'}`);
    });

    const loadedCount = status.filter(m => m.loaded).length;
    console.log(`\nLoaded: ${loadedCount}/${status.length} modules`);
}

// Run module health check
// checkModuleHealth();

// ========================================
// PHASE 6: Performance Check
// ========================================

async function checkPerformance() {
    console.log('\nPerformance Test:');

    const tabs = ['dashboard', 'chat', 'vscode', 'rag'];
    const timings = [];

    for (const tabId of tabs) {
        const start = performance.now();
        window.Navigation.navigateTo(tabId);
        await new Promise(r => setTimeout(r, 100));
        const duration = performance.now() - start;
        timings.push({ tab: tabId, duration });
        console.log(`  ${tabId}: ${duration.toFixed(2)}ms`);
    }

    const avg = timings.reduce((sum, t) => sum + t.duration, 0) / timings.length;
    console.log(`\nAverage: ${avg.toFixed(2)}ms ${avg < 500 ? '‚úì' : '‚úó (>500ms)'}`);
}

// Run performance test
// checkPerformance();

// ========================================
// RUN ALL TESTS
// ========================================

async function runAllTests() {
    console.clear();
    console.log('========================================');
    console.log('AGRO GUI VALIDATION - FULL TEST SUITE');
    console.log('========================================\n');

    await testTabNavigation();
    await testRAGSubtabs();
    await testBackwardCompat();
    checkModuleHealth();
    await checkPerformance();

    console.log('\n========================================');
    console.log('‚úì ALL TESTS COMPLETE');
    console.log('========================================');
}

// Uncomment to run all tests:
// runAllTests();

console.log('\nüìã Test functions loaded. Run: runAllTests()');
        </pre>
        <button onclick="copyToClipboard()">Copy to Clipboard</button>
    </div>

    <div class="test-section">
        <h2>Summary & Recommendations</h2>
        <div id="summary">
            <h3>Current Status</h3>
            <ul>
                <li class="pass">‚úì Test instrumentation created (test-instrumentation.js)</li>
                <li class="pass">‚úì Infinite recursion bug fixed (navigation.js)</li>
                <li class="pass">‚úì Playwright navigation tests: 12/13 passing (92%)</li>
                <li class="warn">‚ö† Event emission test fails (timing issue, not critical)</li>
                <li class="warn">‚è≥ Manual browser validation pending</li>
                <li class="warn">‚è≥ Full GUI test suite pending</li>
            </ul>

            <h3>Next Steps</h3>
            <ol>
                <li>Open AGRO GUI: <a href="http://127.0.0.1:8012/gui/index.html" target="_blank">http://127.0.0.1:8012/gui/index.html</a></li>
                <li>Open browser DevTools (F12) ‚Üí Console tab</li>
                <li>Copy and paste the manual test script above</li>
                <li>Run: <code>runAllTests()</code></li>
                <li>Document results</li>
                <li>Run full Playwright suite</li>
                <li>Generate final report</li>
            </ol>

            <h3>Blockers Found & Fixed</h3>
            <ul>
                <li class="pass">‚úì FIXED: test-instrumentation.js missing (caused 11/13 test failures)</li>
                <li class="pass">‚úì FIXED: Infinite recursion navigation.js ‚Üî tabs.js (caused stack overflow)</li>
            </ul>

            <h3>Known Issues (Non-Blocking)</h3>
            <ul>
                <li class="warn">Event emission test timing issue (cosmetic, events do work)</li>
            </ul>
        </div>
    </div>

    <script>
        document.getElementById('timestamp').textContent = new Date().toLocaleString();

        function copyToClipboard() {
            const text = document.getElementById('manual-tests').textContent;
            navigator.clipboard.writeText(text).then(() => {
                alert('‚úì Test script copied to clipboard!\n\nNow:\n1. Open AGRO GUI\n2. Open DevTools (F12)\n3. Paste into Console\n4. Run: runAllTests()');
            });
        }

        function runAllChecks() {
            alert('Manual checks require browser console access.\n\nSteps:\n1. Open AGRO GUI in new tab\n2. Press F12 (DevTools)\n3. Copy the test script above\n4. Paste into Console\n5. Run: runAllTests()');
        }
    </script>
</body>
</html>
