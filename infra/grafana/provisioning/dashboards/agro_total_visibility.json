{
  "title": "AGRO Total Visibility",
  "style": "dark",
  "refresh": "10s",
  "tags": ["agro", "observability", "rag"],
  "timezone": "",
  "editable": true,
  "graphTooltip": 0,
  "time": {"from": "now-6h", "to": "now"},
  "annotations": {"list": [{
    "type": "grafana",
    "builtIn": 1,
    "datasource": {"type": "grafana", "uid": "-- Grafana --"},
    "enable": true,
    "hide": true,
    "iconColor": "rgba(0, 211, 255, 1)",
    "name": "Annotations & Alerts",
    "target": {"limit": 100, "matchAny": false, "tags": [], "type": "dashboard"}
  }]},
  "panels": [
    {"type": "row", "title": "Indexing Performance", "collapsed": false, "gridPos": {"h": 1, "w": 24, "x": 0, "y": 0}},
    {
      "type": "logs",
      "title": "Indexing Runs (latest 100)",
      "datasource": {"type": "loki", "uid": "loki"},
      "gridPos": {"h": 9, "w": 24, "x": 0, "y": 1},
      "options": {"dedupStrategy": "none", "enableLogDetails": true, "showTime": true, "wrapLogMessage": true},
      "targets": [{"expr": "{filename=~\\".*/data/tracking/indexing_events.jsonl\\"} | json", "refId": "A"}]
    },
    {"type": "row", "title": "Query Traceability", "collapsed": false, "gridPos": {"h": 1, "w": 24, "x": 0, "y": 10}},
    {
      "type": "timeseries",
      "title": "Stage Duration (avg over 5m)",
      "datasource": {"type": "prometheus", "uid": "PBFA97CFB590B2093"},
      "gridPos": {"h": 9, "w": 24, "x": 0, "y": 11},
      "fieldConfig": {"defaults": {"unit": "s"}, "overrides": []},
      "options": {"legend": {"displayMode": "table", "placement": "right"}, "tooltip": {"mode": "multi"}},
      "targets": [{
        "expr": "sum(rate(agro_request_duration_seconds_sum{stage=~\\"(vector_search|bm25_search|cross_encoder_rerank|hydrate|request)\\"}[5m])) by (stage) / sum(rate(agro_request_duration_seconds_count{stage=~\\"(vector_search|bm25_search|cross_encoder_rerank|hydrate|request)\\"}[5m])) by (stage)",
        "legendFormat": "{{stage}}",
        "refId": "A"
      }]
    },
    {
      "type": "logs",
      "title": "Trace Steps (latest 100)",
      "datasource": {"type": "loki", "uid": "loki"},
      "gridPos": {"h": 9, "w": 24, "x": 0, "y": 20},
      "options": {"dedupStrategy": "none", "enableLogDetails": true, "showTime": true, "wrapLogMessage": true},
      "targets": [{"expr": "{filename=~\\".*/data/tracking/trace_steps.jsonl\\"} | json", "refId": "A"}]
    },
    {
      "type": "timeseries",
      "title": "Tokens by Stage (5m sum)",
      "datasource": {"type": "prometheus", "uid": "PBFA97CFB590B2093"},
      "gridPos": {"h": 8, "w": 12, "x": 0, "y": 29},
      "fieldConfig": {"defaults": {"unit": "short"}, "overrides": []},
      "options": {"legend": {"displayMode": "table", "placement": "right"}},
      "targets": [{
        "expr": "sum(increase(agro_tokens_total{role=\"stage\"}[5m])) by (provider,model)",
        "legendFormat": "{{provider}}:{{model}}",
        "refId": "A"
      }]
    },
    {
      "type": "timeseries",
      "title": "Cost by Stage (5m sum)",
      "datasource": {"type": "prometheus", "uid": "PBFA97CFB590B2093"},
      "gridPos": {"h": 8, "w": 12, "x": 12, "y": 29},
      "fieldConfig": {"defaults": {"unit": "currencyUSD"}, "overrides": []},
      "options": {"legend": {"displayMode": "table", "placement": "right"}},
      "targets": [{
        "expr": "sum(increase(agro_cost_usd_total[5m])) by (provider,model)",
        "legendFormat": "{{provider}}:{{model}}",
        "refId": "A"
      }]
    },
    {"type": "row", "title": "Evaluation & Quality", "collapsed": false, "gridPos": {"h": 1, "w": 24, "x": 0, "y": 29}},
    {
      "type": "logs",
      "title": "Latest Evaluation",
      "datasource": {"type": "loki", "uid": "loki"},
      "gridPos": {"h": 6, "w": 24, "x": 0, "y": 37},
      "options": {"dedupStrategy": "none", "enableLogDetails": true, "showTime": true, "wrapLogMessage": true},
      "targets": [{"expr": "{filename=~\\".*/data/tracking/evals_latest.json\\"} | json", "refId": "A"}]
    }
  ],
  "schemaVersion": 39,
  "version": 1
}
