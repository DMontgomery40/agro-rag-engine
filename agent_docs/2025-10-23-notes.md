## 2025-10-23 Session Notes

- Hardened config persistence:
  - `server/app.py`: `_atomic_write_text` helper now writes `.env`, `repos.json`, onboarding, and editor settings via fsync + atomic rename. JSON parse failures log instead of silently returning `{repos: []}`.
  - Restarted `agro-api` to pick up the updated `repos.json`; `/api/config` once again returns the `agro` repo so the keywords manager renders.
- UI event bus fix:
  - `gui/js/core-utils.js`: added a lightweight `events` emitter so Navigation emits/consumes `nav:tab-change` and `tab-switched` reliably. This resolved the Playwright MCP navigation regression.
- Navigation scoping cleanup:
  - Added `data-nav="mobile"` / `data-nav="desktop"` attributes in `gui/index.html` and updated associated JS (`tabs.js`, `navigation.js`, `rag-navigation.js`, `test-instrumentation.js`, mobile drawer script) so selectors only target the desktop nav while mobile buttons delegate through the drawer. Prevents duplicate-target issues flagged in the Wave 3 checklist.
- Verification:
  - Playwright MCP (`tests/gui/rag-data-quality.spec.ts`) – pass.
  - Playwright MCP (`tests/gui/navigation.spec.ts`) – pass (including the previously failing navigation-events assertion).
